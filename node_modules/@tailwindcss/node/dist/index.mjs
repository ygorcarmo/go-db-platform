var ye=Object.defineProperty;var Ae=(e,t)=>{for(var r in t)ye(e,r,{get:t[r],enumerable:!0})};import*as N from"node:module";import{pathToFileURL as lt}from"node:url";var P={};Ae(P,{DEBUG:()=>b});var b=Re(process.env.DEBUG);function Re(e){if(e===void 0)return!1;if(e==="true"||e==="1")return!0;if(e==="false"||e==="0")return!1;if(e==="*")return!0;let t=e.split(",").map(r=>r.split(":")[0]);return t.includes("-tailwindcss")?!1:!!t.includes("tailwindcss")}import x from"enhanced-resolve";import{createJiti as qe}from"jiti";import z from"node:fs";import ue from"node:fs/promises";import B,{dirname as oe}from"node:path";import{pathToFileURL as le}from"node:url";import{__unstable__loadDesignSystem as Qe,compile as Ye,compileAst as Xe,Features as Ze}from"tailwindcss";import D from"node:fs/promises";import y from"node:path";var Se=[/import[\s\S]*?['"](.{3,}?)['"]/gi,/import[\s\S]*from[\s\S]*?['"](.{3,}?)['"]/gi,/export[\s\S]*from[\s\S]*?['"](.{3,}?)['"]/gi,/require\(['"`](.+)['"`]\)/gi],we=[".js",".cjs",".mjs"],ve=["",".js",".cjs",".mjs",".ts",".cts",".mts",".jsx",".tsx"],Ce=["",".ts",".cts",".mts",".tsx",".js",".cjs",".mjs",".jsx"];async function Ee(e,t){for(let r of t){let s=`${e}${r}`;if((await D.stat(s).catch(()=>null))?.isFile())return s}for(let r of t){let s=`${e}/index${r}`;if(await D.access(s).then(()=>!0,()=>!1))return s}return null}async function K(e,t,r,s){let i=we.includes(s)?ve:Ce,o=await Ee(y.resolve(r,t),i);if(o===null||e.has(o))return;e.add(o),r=y.dirname(o),s=y.extname(o);let n=await D.readFile(o,"utf-8"),a=[];for(let l of Se)for(let c of n.matchAll(l))c[1].startsWith(".")&&a.push(K(e,c[1],r,s));await Promise.all(a)}async function H(e){let t=new Set;return await K(t,e,y.dirname(e),y.extname(e)),Array.from(t)}import*as M from"node:path";var A=92,v=47,C=42,_e=34,$e=39,ke=58,E=59,g=10,R=32,_=9,J=123,T=125,j=40,V=41,Ne=91,be=93,q=45,U=64,Pe=33;function Q(e){e=e.replaceAll(`\r
`,`
`);let t=[],r=[],s=[],i=null,o=null,n="",a="",l;for(let c=0;c<e.length;c++){let f=e.charCodeAt(c);if(f===A)n+=e.slice(c,c+2),c+=1;else if(f===v&&e.charCodeAt(c+1)===C){let u=c;for(let p=c+2;p<e.length;p++)if(l=e.charCodeAt(p),l===A)p+=1;else if(l===C&&e.charCodeAt(p+1)===v){c=p+1;break}let m=e.slice(u,c+1);m.charCodeAt(2)===Pe&&r.push(Z(m.slice(2,-2)))}else if(f===$e||f===_e){let u=c;for(let m=c+1;m<e.length;m++)if(l=e.charCodeAt(m),l===A)m+=1;else if(l===f){c=m;break}else{if(l===E&&e.charCodeAt(m+1)===g)throw new Error(`Unterminated string: ${e.slice(u,m+1)+String.fromCharCode(f)}`);if(l===g)throw new Error(`Unterminated string: ${e.slice(u,m)+String.fromCharCode(f)}`)}n+=e.slice(u,c+1)}else{if((f===R||f===g||f===_)&&(l=e.charCodeAt(c+1))&&(l===R||l===g||l===_))continue;if(f===g){if(n.length===0)continue;l=n.charCodeAt(n.length-1),l!==R&&l!==g&&l!==_&&(n+=" ")}else if(f===q&&e.charCodeAt(c+1)===q&&n.length===0){let u="",m=c,p=-1;for(let d=c+2;d<e.length;d++)if(l=e.charCodeAt(d),l===A)d+=1;else if(l===v&&e.charCodeAt(d+1)===C){for(let h=d+2;h<e.length;h++)if(l=e.charCodeAt(h),l===A)h+=1;else if(l===C&&e.charCodeAt(h+1)===v){d=h+1;break}}else if(p===-1&&l===ke)p=n.length+d-m;else if(l===E&&u.length===0){n+=e.slice(m,d),c=d;break}else if(l===j)u+=")";else if(l===Ne)u+="]";else if(l===J)u+="}";else if((l===T||e.length-1===d)&&u.length===0){c=d-1,n+=e.slice(m,d);break}else(l===V||l===be||l===T)&&u.length>0&&e[d]===u[u.length-1]&&(u=u.slice(0,-1));let G=O(n,p);i?i.nodes.push(G):t.push(G),n=""}else if(f===E&&n.charCodeAt(0)===U)o=S(n),i?i.nodes.push(o):t.push(o),n="",o=null;else if(f===E&&a[a.length-1]!==")"){let u=O(n);i?i.nodes.push(u):t.push(u),n=""}else if(f===J&&a[a.length-1]!==")")a+="}",o=Y(n.trim()),i&&i.nodes.push(o),s.push(i),i=o,n="",o=null;else if(f===T&&a[a.length-1]!==")"){if(a==="")throw new Error("Missing opening {");if(a=a.slice(0,-1),n.length>0)if(n.charCodeAt(0)===U)o=S(n),i?i.nodes.push(o):t.push(o),n="",o=null;else{let m=n.indexOf(":");i&&i.nodes.push(O(n,m))}let u=s.pop()??null;u===null&&i&&t.push(i),i=u,n="",o=null}else if(f===j)a+=")",n+="(";else if(f===V){if(a[a.length-1]!==")")throw new Error("Missing opening (");a=a.slice(0,-1),n+=")"}else{if(n.length===0&&(f===R||f===g||f===_))continue;n+=String.fromCharCode(f)}}}if(n.charCodeAt(0)===U&&t.push(S(n)),a.length>0&&i){if(i.kind==="rule")throw new Error(`Missing closing } at ${i.selector}`);if(i.kind==="at-rule")throw new Error(`Missing closing } at ${i.name} ${i.params}`)}return r.length>0?r.concat(t):t}function S(e,t=[]){for(let r=5;r<e.length;r++){let s=e.charCodeAt(r);if(s===R||s===j){let i=e.slice(0,r).trim(),o=e.slice(r).trim();return I(i,o,t)}}return I(e.trim(),"",t)}function O(e,t=e.indexOf(":")){let r=e.indexOf("!important",t+1);return X(e.slice(0,t).trim(),e.slice(t+1,r===-1?e.length:r).trim(),r!==-1)}var De=64;function Te(e,t=[]){return{kind:"rule",selector:e,nodes:t}}function I(e,t="",r=[]){return{kind:"at-rule",name:e,params:t,nodes:r}}function Y(e,t=[]){return e.charCodeAt(0)===De?S(e,t):Te(e,t)}function X(e,t,r=!1){return{kind:"declaration",property:e,value:t,important:r}}function Z(e){return{kind:"comment",value:e}}function $(e,t,r=[],s={}){for(let i=0;i<e.length;i++){let o=e[i],n=r[r.length-1]??null;if(o.kind==="context"){if($(o.nodes,t,r,{...s,...o.context})===2)return 2;continue}r.push(o);let a=t(o,{parent:n,context:s,path:r,replaceWith(l){Array.isArray(l)?l.length===0?e.splice(i,1):l.length===1?e[i]=l[0]:e.splice(i,1,...l):e[i]=l,i--}})??0;if(r.pop(),a===2)return 2;if(a!==1&&(o.kind==="rule"||o.kind==="at-rule")){r.push(o);let l=$(o.nodes,t,r,s);if(r.pop(),l===2)return 2}}}function ee(e){function t(s,i=0){let o="",n="  ".repeat(i);if(s.kind==="declaration")o+=`${n}${s.property}: ${s.value}${s.important?" !important":""};
`;else if(s.kind==="rule"){o+=`${n}${s.selector} {
`;for(let a of s.nodes)o+=t(a,i+1);o+=`${n}}
`}else if(s.kind==="at-rule"){if(s.nodes.length===0)return`${n}${s.name} ${s.params};
`;o+=`${n}${s.name}${s.params?` ${s.params} `:" "}{
`;for(let a of s.nodes)o+=t(a,i+1);o+=`${n}}
`}else if(s.kind==="comment")o+=`${n}/*${s.value}*/
`;else if(s.kind==="context"||s.kind==="at-root")return"";return o}let r="";for(let s of e){let i=t(s);i!==""&&(r+=i)}return r}function Ue(e,t){if(typeof e!="string")throw new TypeError("expected path to be a string");if(e==="\\"||e==="/")return"/";var r=e.length;if(r<=1)return e;var s="";if(r>4&&e[3]==="\\"){var i=e[2];(i==="?"||i===".")&&e.slice(0,2)==="\\\\"&&(e=e.slice(2),s="//")}var o=e.split(/[/\\]+/);return t!==!1&&o[o.length-1]===""&&o.pop(),s+o.join("/")}function F(e){let t=Ue(e);return e.startsWith("\\\\")&&t.startsWith("/")&&!t.startsWith("//")?`/${t}`:t}var L=/(?<!@import\s+)(?<=^|[^\w\-\u0080-\uffff])url\((\s*('[^']+'|"[^"]+")\s*|[^'")]+)\)/,te=/(?<=image-set\()((?:[\w-]{1,256}\([^)]*\)|[^)])*)(?=\))/,Oe=/(?:gradient|element|cross-fade|image)\(/,je=/^\s*data:/i,Ie=/^([a-z]+:)?\/\//,Fe=/^[A-Z_][.\w-]*\(/i,Me=/(?:^|\s)(?<url>[\w-]+\([^)]*\)|"[^"]*"|'[^']*'|[^,]\S*[^,])\s*(?:\s(?<descriptor>\w[^,]+))?(?:,|$)/g,Le=/(?<!\\)"/g,Be=/(?: |\\t|\\n|\\f|\\r)+/g,We=e=>je.test(e),ze=e=>Ie.test(e);async function re({css:e,base:t,root:r}){if(!e.includes("url(")&&!e.includes("image-set("))return e;let s=Q(e),i=[];function o(n){if(n[0]==="/")return n;let a=M.posix.join(F(t),n),l=M.posix.relative(F(r),a);return l.startsWith(".")||(l="./"+l),l}return $(s,n=>{if(n.kind!=="declaration"||!n.value)return;let a=L.test(n.value),l=te.test(n.value);if(a||l){let c=l?Ge:se;i.push(c(n.value,o).then(f=>{n.value=f}))}}),i.length&&await Promise.all(i),ee(s)}function se(e,t){return ne(e,L,async r=>{let[s,i]=r;return await ie(i.trim(),s,t)})}async function Ge(e,t){return await ne(e,te,async r=>{let[,s]=r;return await He(s,async({url:o})=>L.test(o)?await se(o,t):Oe.test(o)?o:await ie(o,o,t))})}async function ie(e,t,r,s="url"){let i="",o=e[0];if((o==='"'||o==="'")&&(i=o,e=e.slice(1,-1)),Ke(e))return t;let n=await r(e);return i===""&&n!==encodeURI(n)&&(i='"'),i==="'"&&n.includes("'")&&(i='"'),i==='"'&&n.includes('"')&&(n=n.replace(Le,'\\"')),`${s}(${i}${n}${i})`}function Ke(e){return ze(e)||We(e)||e[0]==="#"||Fe.test(e)}function He(e,t){return Promise.all(Je(e).map(async({url:r,descriptor:s})=>({url:await t({url:r,descriptor:s}),descriptor:s}))).then(Ve)}function Je(e){let t=e.trim().replace(Be," ").replace(/\r?\n/,"").replace(/,\s+/,", ").replaceAll(/\s+/g," ").matchAll(Me);return Array.from(t,({groups:r})=>({url:r?.url?.trim()??"",descriptor:r?.descriptor?.trim()??""})).filter(({url:r})=>!!r)}function Ve(e){return e.map(({url:t,descriptor:r})=>t+(r?` ${r}`:"")).join(", ")}async function ne(e,t,r){let s,i=e,o="";for(;s=t.exec(i);)o+=i.slice(0,s.index),o+=await r(s),i=i.slice(s.index+s[0].length);return o+=i,o}function me({base:e,onDependency:t,shouldRewriteUrls:r,customCssResolver:s,customJsResolver:i}){return{base:e,async loadModule(o,n){return pe(o,n,t,i)},async loadStylesheet(o,n){let a=await ge(o,n,t,s);return r&&(a.content=await re({css:a.content,root:n,base:a.base})),a}}}async function de(e,t){if(e.root&&e.root!=="none"){let r=/[*{]/,s=[];for(let o of e.root.pattern.split("/")){if(r.test(o))break;s.push(o)}if(!await ue.stat(B.resolve(t,s.join("/"))).then(o=>o.isDirectory()).catch(()=>!1))throw new Error(`The \`source(${e.root.pattern})\` does not exist`)}}async function et(e,t){let r=await Xe(e,me(t));return await de(r,t.base),r}async function tt(e,t){let r=await Ye(e,me(t));return await de(r,t.base),r}async function rt(e,{base:t}){return Qe(e,{base:t,async loadModule(r,s){return pe(r,s,()=>{})},async loadStylesheet(r,s){return ge(r,s,()=>{})}})}async function pe(e,t,r,s){if(e[0]!=="."){let a=await fe(e,t,s);if(!a)throw new Error(`Could not resolve '${e}' from '${t}'`);let l=await ce(le(a).href);return{base:oe(a),module:l.default??l}}let i=await fe(e,t,s);if(!i)throw new Error(`Could not resolve '${e}' from '${t}'`);let[o,n]=await Promise.all([ce(le(i).href+"?id="+Date.now()),H(i)]);for(let a of n)r(a);return{base:oe(i),module:o.default??o}}async function ge(e,t,r,s){let i=await it(e,t,s);if(!i)throw new Error(`Could not resolve '${e}' from '${t}'`);if(r(i),typeof globalThis.__tw_readFile=="function"){let n=await globalThis.__tw_readFile(i,"utf-8");if(n)return{base:B.dirname(i),content:n}}let o=await ue.readFile(i,"utf-8");return{base:B.dirname(i),content:o}}var ae=null;async function ce(e){if(typeof globalThis.__tw_load=="function"){let t=await globalThis.__tw_load(e);if(t)return t}try{return await import(e)}catch{return ae??=qe(import.meta.url,{moduleCache:!1,fsCache:!1}),await ae.import(e)}}var st=x.ResolverFactory.createResolver({fileSystem:new x.CachedInputFileSystem(z,4e3),useSyncFileSystemCalls:!0,extensions:[".css"],mainFields:["style"],conditionNames:["style"]});async function it(e,t,r){if(typeof globalThis.__tw_resolve=="function"){let s=globalThis.__tw_resolve(e,t);if(s)return Promise.resolve(s)}if(r){let s=await r(e,t);if(s)return s}return W(st,e,t)}var nt=x.ResolverFactory.createResolver({fileSystem:new x.CachedInputFileSystem(z,4e3),useSyncFileSystemCalls:!0,extensions:[".js",".json",".node",".ts"],conditionNames:["node","import"]}),ot=x.ResolverFactory.createResolver({fileSystem:new x.CachedInputFileSystem(z,4e3),useSyncFileSystemCalls:!0,extensions:[".js",".json",".node",".ts"],conditionNames:["node","require"]});async function fe(e,t,r){if(typeof globalThis.__tw_resolve=="function"){let s=globalThis.__tw_resolve(e,t);if(s)return Promise.resolve(s)}if(r){let s=await r(e,t);if(s)return s}return W(nt,e,t).catch(()=>W(ot,e,t))}function W(e,t,r){return new Promise((s,i)=>e.resolve({},r,t,{},(o,n)=>{if(o)return i(o);s(n)}))}var w=class extends Map{constructor(r){super();this.factory=r}get(r){let s=super.get(r);return s===void 0&&(s=this.factory(r,this),this.set(r,s)),s}};Symbol.dispose??=Symbol("Symbol.dispose");Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");var he=class{constructor(t=r=>void process.stderr.write(`${r}
`)){this.defaultFlush=t}#r=new w(()=>({value:0}));#t=new w(()=>({value:0n}));#e=[];hit(t){this.#r.get(t).value++}start(t){let r=this.#e.map(i=>i.label).join("//"),s=`${r}${r.length===0?"":"//"}${t}`;this.#r.get(s).value++,this.#t.get(s),this.#e.push({id:s,label:t,namespace:r,value:process.hrtime.bigint()})}end(t){let r=process.hrtime.bigint();if(this.#e[this.#e.length-1].label!==t)throw new Error(`Mismatched timer label: \`${t}\`, expected \`${this.#e[this.#e.length-1].label}\``);let s=this.#e.pop(),i=r-s.value;this.#t.get(s.id).value+=i}reset(){this.#r.clear(),this.#t.clear(),this.#e.splice(0)}report(t=this.defaultFlush){let r=[],s=!1;for(let n=this.#e.length-1;n>=0;n--)this.end(this.#e[n].label);for(let[n,{value:a}]of this.#r.entries()){if(this.#t.has(n))continue;r.length===0&&(s=!0,r.push("Hits:"));let l=n.split("//").length;r.push(`${"  ".repeat(l)}${n} ${k(xe(`\xD7 ${a}`))}`)}this.#t.size>0&&s&&r.push(`
Timers:`);let i=-1/0,o=new Map;for(let[n,{value:a}]of this.#t){let l=`${(Number(a)/1e6).toFixed(2)}ms`;o.set(n,l),i=Math.max(i,l.length)}for(let n of this.#t.keys()){let a=n.split("//").length;r.push(`${k(`[${o.get(n).padStart(i," ")}]`)}${"  ".repeat(a-1)}${a===1?" ":k(" \u21B3 ")}${n.split("//").pop()} ${this.#r.get(n).value===1?"":k(xe(`\xD7 ${this.#r.get(n).value}`))}`.trimEnd())}t(`
${r.join(`
`)}
`),this.reset()}[Symbol.dispose](){b&&this.report()}};function k(e){return`\x1B[2m${e}\x1B[22m`}function xe(e){return`\x1B[34m${e}\x1B[39m`}if(!process.versions.bun){let e=N.createRequire(import.meta.url);N.register?.(lt(e.resolve("@tailwindcss/node/esm-cache-loader")))}export{Ze as Features,he as Instrumentation,rt as __unstable__loadDesignSystem,tt as compile,et as compileAst,P as env,F as normalizePath};
